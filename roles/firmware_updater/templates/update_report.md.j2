# Rapport de Mise √† Jour Firmware

## Informations G√©n√©rales

| Param√®tre | Valeur |
|-----------|--------|
| **Switch** | {{ current_hostname | default(inventory_hostname) }} |
| **Adresse IP** | {{ inventory_hostname }} |
| **Plateforme** | {{ current_platform | default('Unknown') }} |
| **Date de d√©but** | {{ update_start_time }} |
| **Date de fin** | {{ update_end_time | default('N/A') }} |
| **Dur√©e totale** | {{ update_duration | default('N/A') }}s ({{ (update_duration | default(0) | int / 60) | round(1) }}min) |
| **Statut final** | {{ update_status | upper }} |

## √âtat Avant Mise √† Jour

| Param√®tre | Valeur |
|-----------|--------|
| **Version en cours** | {{ firmware_state_before_update.current_version | default('N/A') }} |
| **Image Primary** | {{ firmware_state_before_update.primary_image | default('N/A') }} |
| **Image Secondary** | {{ firmware_state_before_update.secondary_image | default('N/A') }} |
| **Partition de boot** | {{ firmware_state_before_update.default_image | default('N/A') }} |
| **Uptime** | {{ firmware_state_before_update.uptime | default('N/A') }} |
| **Espace libre** | {{ firmware_state_before_update.free_space | default('N/A') }}MB |

## Configuration de la Mise √† Jour

| Param√®tre | Valeur |
|-----------|--------|
| **Version cible** | {{ target_firmware_version }} |
| **Fichier firmware** | {{ firmware_file_path if upload_method == 'local' else remote_firmware_url }} |
| **M√©thode d'upload** | {{ upload_method | upper }} |
| **Strat√©gie de partition** | {{ partition_strategy | upper }} |
| **Partition choisie** | {{ chosen_partition | default('N/A') }} |
| **Sauvegarde config** | {{ backup_config | ternary('‚úì Activ√©e', '‚úó D√©sactiv√©e') }} |
| **V√©rification post-update** | {{ verify_post_update | ternary('‚úì Activ√©e', '‚úó D√©sactiv√©e') }} |
| **Rollback automatique** | {{ rollback_on_failure | ternary('‚úì Activ√©', '‚úó D√©sactiv√©') }} |

## Processus de Mise √† Jour

### üìã Pr√©requis
{% if update_errors | length == 0 or 'prerequisites' not in (update_errors | join(' ')) %}
‚úÖ **R√©ussi** - Tous les pr√©requis valid√©s
{% else %}
‚ùå **√âchec** - Pr√©requis non satisfaits
{% endif %}

### üíæ Sauvegarde
{% if backup_completed | default(false) %}
‚úÖ **R√©ussie**
- Fichier: {{ backup_filename | default('N/A') }}
- Taille: {{ backup_info.backup_size_bytes | default(0) }} bytes
- Dur√©e: {{ backup_duration | default('N/A') }}s
- Stockage distant: {{ backup_info.repository_stored | default(false) | ternary('‚úì', '‚úó') }}
{% else %}
{% if backup_config %}
‚ùå **√âchec** - Sauvegarde activ√©e mais √©chou√©e
{% else %}
‚è≠Ô∏è **Ignor√©e** - Sauvegarde d√©sactiv√©e
{% endif %}
{% endif %}

### üì§ Upload Firmware
{% if firmware_upload_result is defined and firmware_upload_result is succeeded %}
‚úÖ **R√©ussi**
- Partition: {{ chosen_partition }}
- Dur√©e: {{ upload_duration | default('N/A') }}s ({{ (upload_duration | default(0) | int / 60) | round(1) }}min)
- V√©rification: {{ upload_verification.verified | default(false) | ternary('‚úì', '‚úó') }}
{% elif 'upload' in update_status %}
‚ùå **√âchec** - Probl√®me durant l'upload
{% else %}
‚è≠Ô∏è **Ignor√©** - Upload non n√©cessaire
{% endif %}

### üîÑ Red√©marrage
{% if reboot_verification is defined %}
{% if reboot_verification.success %}
‚úÖ **R√©ussi**
- Partition de boot: {{ reboot_verification.boot_partition }}
- Version en cours: {{ reboot_verification.running_version }}
- Dur√©e: {{ reboot_verification.duration | default('N/A') }}s ({{ (reboot_verification.duration | default(0) | int / 60) | round(1) }}min)
{% else %}
‚ùå **√âchec**
- Erreur: {{ reboot_verification.error | default('Red√©marrage √©chou√©') }}
{% endif %}
{% elif reboot_needed | default(true) %}
‚ùå **√âchec** - Red√©marrage requis mais √©chou√©
{% else %}
‚è≠Ô∏è **Ignor√©** - Red√©marrage non n√©cessaire
{% endif %}

### ‚úÖ V√©rification
{% if verification_results is defined %}
{% if verification_passed | default(false) %}
‚úÖ **R√©ussie** ({{ verification_score | default(0) }}%)
{% else %}
‚ùå **√âchec** ({{ verification_score | default(0) }}%)
{% endif %}

## D√©tails des v√©rifications
{% for check, result in verification_results.items() %}
{%- if check != 'overall' and check != 'state_comparison' %}
- {{ check.replace('_', ' ').title() }}: {{ result.status | default(false) | ternary('‚úì', '‚úó') }}
{%- if not result.status | default(true) and result.error is defined %}
  - Erreur: {{ result.error }}
{%- endif %}
{%- endif %}
{% endfor %}
{% else %}
‚è≠Ô∏è **Ignor√©e** - V√©rification d√©sactiv√©e ou non ex√©cut√©e
{% endif %}

## √âtat Apr√®s Mise √† Jour

{% if state_comparison is defined %}
| Param√®tre | Avant | Apr√®s | Chang√© |
|-----------|-------|-------|--------|
| **Version** | {{ state_comparison.before.version }} | {{ state_comparison.after.version }} | {{ state_comparison.changes.version_changed | ternary('‚úì', '‚úó') }} |
| **Image Primary** | {{ state_comparison.before.primary_image }} | {{ state_comparison.after.primary_image }} | {{ state_comparison.changes.primary_changed | ternary('‚úì', '‚úó') }} |
| **Image Secondary** | {{ state_comparison.before.secondary_image }} | {{ state_comparison.after.secondary_image }} | {{ state_comparison.changes.secondary_changed | ternary('‚úì', '‚úó') }} |
| **Partition de boot** | {{ state_comparison.before.default_image }} | {{ state_comparison.after.default_image }} | {{ state_comparison.changes.boot_partition_changed | ternary('‚úì', '‚úó') }} |
{% else %}
*Informations de comparaison non disponibles*
{% endif %}

## M√©triques de Performance

| M√©trique | Valeur |
|----------|--------|
| **Temps d'upload** | {{ upload_duration | default('N/A') }}s |
| **Temps de red√©marrage** | {{ reboot_duration | default('N/A') }}s |
| **Temps de v√©rification** | {{ verification_duration | default('N/A') }}s |
| **Temps total** | {{ update_duration | default('N/A') }}s |
| **Efficacit√©** | {{ (verification_score | default(0)) }}% |

## Erreurs et Avertissements

{% if update_errors | length > 0 -%}
{% for error in update_errors -%}
‚ùå {{ error }}
{% endfor %}
{%- else -%}
‚úÖ Aucune erreur signal√©e
{% endif %}

{% if rollback_performed | default(false) %}
## üîÑ Rollback Effectu√©

Un rollback automatique a √©t√© effectu√© en raison d'un √©chec de v√©rification.
Le switch est revenu √† la configuration pr√©c√©dente.

**Action recommand√©e:** Analyser les erreurs ci-dessus et corriger avant de retenter la mise √† jour.
{% endif %}

## Recommandations

{% if update_status == 'completed' %}
‚úÖ **Mise √† jour r√©ussie**
- La mise √† jour s'est d√©roul√©e sans probl√®me
- Le switch fonctionne avec la nouvelle version
- Aucune action suppl√©mentaire requise

{% elif update_status == 'failed' %}
‚ùå **Mise √† jour √©chou√©e**
- Analyser les erreurs list√©es ci-dessus
- V√©rifier les pr√©requis (espace disque, connectivit√©)
- Consulter les logs d√©taill√©s d'Ansible
- Contacter le support si n√©cessaire

{% elif update_status == 'verification_failed' %}
‚ö†Ô∏è **V√©rification √©chou√©e**
- La mise √† jour a √©t√© appliqu√©e mais la v√©rification a √©chou√©
- V√©rifier manuellement l'√©tat du switch
- Possible rollback effectu√© automatiquement

{% elif update_status == 'critical_failure' %}
üö® **√âchec critique**
- Le switch peut √™tre inaccessible
- Intervention manuelle requise
- Acc√®s console s√©rie recommand√©
- Contacter le support technique
{% endif %}

---

**Rapport g√©n√©r√© le {{ '%Y-%m-%d %H:%M:%S' | strftime }} par Ansible Firmware Updater**

*Pour plus de d√©tails, consulter les logs Ansible complets*